<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>국어 3단원 평가 인포그래픽</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F0F4F8;
            color: #073B4C;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .chart-container-large {
            position: relative;
            width: 100%;
            max-width: 1024px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 500px;
        }
         @media (min-width: 768px) {
            .chart-container-large {
                height: 500px;
            }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white shadow-md w-full sticky top-0 z-10">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-2xl md:text-3xl font-bold text-center text-[#073B4C]">국어 3단원 토의 활동: 동료 평가 및 자기 평가 인포그래픽</h1>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">

            <section class="md:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#118AB2] mb-3">들어가며: 우리의 토의 태도 되돌아보기</h2>
                <p class="text-base md:text-lg leading-relaxed">
                    이번 국어 3단원 토의 활동을 마무리하며, 우리는 동료 평가와 자기 평가를 통해 자신의 토의 태도를 되돌아보는 시간을 가졌습니다. 이 인포그래픽은 우리가 서로를 어떻게 평가했는지, 그리고 스스로를 어떻게 생각하는지 데이터를 통해 살펴봅니다.
                </p>
            </section>

            <section class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#118AB2] mb-4">전체 평균 점수</h3>
                <p class="text-gray-700 mb-6">학급 전체의 동료 평가 평균과 자기 평가 평균 점수입니다. 5점 만점 기준입니다.</p>
                <div class="flex justify-around items-center text-center">
                    <div>
                        <span id="classPeerAvg" class="text-6xl font-bold text-[#FF6B6B]">0.0</span>
                        <p class="text-lg font-semibold text-gray-800 mt-2">동료 평가 평균</p>
                    </div>
                    <div>
                        <span id="classSelfAvg" class="text-6xl font-bold text-[#118AB2]">0.0</span>
                        <p class="text-lg font-semibold text-gray-800 mt-2">자기 평가 평균</p>
                    </div>
                </div>
            </section>

            <section class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#118AB2] mb-4">동료 평가 점수 분포</h3>
                <p class="text-gray-700 mb-6">친구들이 서로에게 준 점수(1점~5점)가 각각 몇 번 나왔는지 보여줍니다.</p>
                <div class="chart-container" style="height: 300px; max-height: 350px;">
                    <canvas id="distributionChart"></canvas>
                </div>
            </section>

            <section class="md:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#118AB2] mb-3">학생별 상세 비교: 동료 평가 vs 자기 평가</h2>
                <p class="text-base md:text-lg leading-relaxed mb-6">
                    각 학생이 동료들에게 받은 평균 점수(빨간색)와 스스로 평가한 평균 점수(파란색)를 나란히 비교합니다. 이를 통해 개인별 인식 차이를 한눈에 볼 수 있습니다.
                </p>
                <div class="chart-container-large">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </section>

            <section class="md:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#118AB2] mb-3">인식 차이 분석: '자기 평가' - '동료 평가'</h2>
                <p class="text-base md:text-lg leading-relaxed mb-6">
                    자신의 평가(자기 평가)와 타인의 평가(동료 평가) 사이의 차이(Gap)를 시각화했습니다.
                    <span class="font-bold text-[#06D6A0]">양수(+) 값</span>은 자신을 동료들보다 더 긍정적으로 평가했음을, 
                    <span class="font-bold text-[#FF6B6B]">음수(-) 값</span>은 자신을 더 낮게 평가했음을 의미합니다.
                </p>
                <div class="chart-container-large">
                    <canvas id="gapChart"></canvas>
                </div>
            </section>
            
            <section class="md:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#118AB2] mb-3">4가지 평가 기준별 분석</h2>
                <p class="text-base md:text-lg leading-relaxed mb-6">
                    우리의 토의 태도를 4가지 세부 기준으로 나누어 분석했습니다. 학급 전체가 각 기준에 대해 동료(빨간색)와 스스로(파란색)를 어떻게 평가했는지 비교해 보세요.
                </p>
            </section>

            <section class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#118AB2] mb-4">기준별 평균 점수 (레이더 차트)</h3>
                <p class="text-gray-700 mb-6">중심에서 멀어질수록 해당 기준의 점수가 높음을 의미합니다.</p>
                <div class="chart-container">
                    <canvas id="criteriaChart"></canvas>
                </div>
            </section>

            <section class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#118AB2] mb-4">주요 발견점</h3>
                <ul class="space-y-4">
                    <li class="flex items-start">
                        <span class="text-2xl text-[#06D6A0] mr-3">✔</span>
                        <div>
                            <h4 class="font-bold text-lg text-gray-800">'경청하기'와 '존댓말 사용'</h4>
                            <p class="text-gray-700">두 항목 모두 동료 평가와 자기 평가에서 비교적 높은 점수를 받았습니다. 우리가 서로의 의견을 잘 듣고 존중하려 노력했음을 보여줍니다.</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="text-2xl text-[#FFD166] mr-3">🔍</span>
                        <div>
                            <h4 class="font-bold text-lg text-gray-800">'끼어들지 않기'</h4>
                            <p class="text-gray-700">자기 평가는 높지만 동료 평가는 상대적으로 낮게 나타났습니다. '나는 끼어들지 않았다'고 생각하지만, 친구들은 가끔 대화에 끼어든다고 느꼈을 수 있습니다.</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="text-2xl text-[#FF6B6B] mr-3">❗</span>
                        <div>
                            <h4 class="font-bold text-lg text-gray-800">'목소리 크기'</h4>
                            <p class="text-gray-700">자기 평가 점수와 동료 평가 점수 간의 차이가 가장 큰 항목 중 하나입니다. '나는 잘 들리게 말했다'고 생각하지만, 듣는 친구들에게는 목소리가 작게 들렸을 가능성이 있습니다.</p>
                        </div>
                    </li>
                </ul>
            </section>
        </div>
    </main>

    <footer class="text-center p-6 mt-8 text-gray-600 text-sm">
        <p>국어 3단원 토의 활동 평가 데이터를 기반으로 생성된 인포그래픽입니다.</p>
    </footer>

    <script>
        const csvData = `타임스탬프,번호는?,이름은?,우리 모둠에서 같이 토의한 친구를 선택하세요.,위 친구가 다른 친구들이 의견을 말하는 도중에 끼어들지 않았나요?,위 친구가 다른 친구들이 의견을 존종하며 높임말을 사용하였나요?,위 친구가 다른 친구들의 의견을 경청하였나요?,위 친구는 들을 수 있는 목소리 크기로 말하였나요?,우리 모둠에서 같이 토의한 친구를 선택하세요.,위 친구가 다른 친구들이 의견을 말하는 도중에 끼어들지 않았나요?,위 친구가 다른 친구들이 의견을 존종하며 높임말을 사용하였나요?,위 친구가 다른 친구들의 의견을 경청하였나요?,위 친구는 들을 수 있는 목소리 크기로 말하였나요?,우리 모둠에서 같이 토의한 친구를 선택하세요.,위 친구가 다른 친구들이 의견을 말하는 도중에 끼어들지 않았나요?,위 친구가 다른 친구들이 의견을 존종하며 높임말을 사용하였나요?,위 친구가 다른 친구들의 의견을 경청하였나요?,위 친구는 들을 수 있는 목소리 크기로 말하였나요?,나는 다른 친구들이 의견을 말하는 도중에 끼어들지 않았나요?,나는 다른 친구들이 의견을 존종하며 높임말을 사용하였나요?,나는 다른 친구들의 의견을 경청하였나요?,나는 들을 수 있는 목소리 크기로 말하였나요?
2025. 10. 27 오전 9:57:07,2번,김소윤,김하영,5,4,5,5,이지환,5,3,4,5,최수아,5,4,5,5,5,4,5,4
2025. 10. 27 오전 9:57:23,17번,최수아,김하영,5,4,4,5,김소윤,5,4,5,3,이지환,5,5,4,5,5,4,4,4
2025. 10. 27 오전 9:57:33,11번,이온유,송서유,5,5,5,4,김해솔,4,1,4,5,지민재,5,1,5,4,5,1,5,3
2025. 10. 27 오전 9:57:37,4번,김하영,김소윤,5,5,5,3,이지환,4,3,5,5,최수아,4,4,3,1,5,4,5,5
2025. 10. 27 오전 9:57:39,5번,김해솔,송서유,5,5,5,5,이온유,5,4,5,2,지민재,5,4,5,5,5,4,5,5
2025. 10. 27 오전 9:57:47,16번,지민재,김해솔,5,1,4,4,송서유,3,5,5,5,이온유,4,4,4,1,4,3,5,4
2025. 10. 27 오전 9:57:56,12번,이의정,한대연,3,1,1,3,김사랑,5,3,3,3,한지완,2,1,1,3,3,4,5,3
2025. 10. 27 오전 9:57:59,8번,송서유,이온유,5,4,5,3,김해솔,5,4,5,5,지민재,5,4,5,5,5,5,5,4
2025. 10. 27 오전 9:57:59,10번,원지현,조연우,4,5,5,5,최유현,4,3,4,3,최시원,4,4,5,4,4,5,5,4
2025. 10. 27 오전 9:58:15,19번,최유현,최시원,2,2,2,5,조연우,4,5,3,4,원지현,3,3,4,2,4,5,5,5
2025. 10. 27 오전 9:58:22,1번,김사랑,이의정,5,5,4,5,한대연,4,3,2,3,한지완,4,3,3,4,5,4,5,4
2025. 10. 27 오전 9:58:34,20번,한대연,한지완,3,3,5,5,한지완,2,3,5,5,한지완,2,3,5,5,2,1,5,3
2025. 10. 27 오전 9:58:45,21번,한지완,김사랑,3,2,4,2,이의정,3,2,3,3,한대연,2,2,2,1,3,3,2,3
2025. 10. 27 오전 9:59:25,18번,최시원,최유현,1,2,1,4,조연우,4,4,5,4,원지현,5,2,2,2,3,2,2,4
2025. 10. 27 오전 9:59:33,13번,이지환,김하영,4,3,4,3,김소윤,4,3,4,3,최수아,4,4,4,4,5,5,3,5
2025. 10. 27 오전 9:59:50,14번,조연우,최유현,1,1,1,2,최시원,2,1,1,1,원지현,4,2,3,2,4,4,5,4`;

        const palette = {
            red: '#FF6B6B',
            yellow: '#FFD166',
            green: '#06D6A0',
            blue: '#118AB2',
            darkBlue: '#073B4C',
            background: '#F0F4F8'
        };

        const criteriaLabels = ["끼어들지 않기", "존댓말 사용", "경청하기", "목소리 크기"];

        const mandatoryTooltipConfig = {
            plugins: {
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) {
                                return label.join(' ');
                            } else {
                                return label;
                            }
                        }
                    }
                }
            }
        };

        function wrapLabels(label) {
            if (typeof label === 'string' && label.length > 16) {
                const words = label.split(' ');
                const lines = [];
                let currentLine = '';
                words.forEach(word => {
                    if ((currentLine + word).length > 16 && currentLine.length > 0) {
                        lines.push(currentLine.trim());
                        currentLine = word + ' ';
                    } else {
                        currentLine += word + ' ';
                    }
                });
                lines.push(currentLine.trim());
                return lines;
            }
            return label;
        }

        function parseData(csvString) {
            const lines = csvString.trim().split('\n');
            const header = lines.shift();
            
            const studentData = {};
            const allPeerScores = [];
            const allSelfScores = [];
            const allPeerScoresByCriteria = [[], [], [], []];
            const allSelfScoresByCriteria = [[], [], [], []];

            const rawEvals = [];

            lines.forEach(line => {
                const cols = line.split(',');
                const name = cols[2].trim();
                
                if (!name) return;

                const selfScores = [
                    parseInt(cols[18]), 
                    parseInt(cols[19]), 
                    parseInt(cols[20]), 
                    parseInt(cols[21])
                ].filter(s => !isNaN(s));

                studentData[name] = {
                    name: name,
                    selfScores: selfScores,
                    selfAvg: selfScores.length ? selfScores.reduce((a, b) => a + b, 0) / selfScores.length : 0,
                    peerScores: [],
                    peerScoresByCriteria: [[], [], [], []]
                };

                allSelfScores.push(...selfScores);
                selfScores.forEach((s, i) => allSelfScoresByCriteria[i].push(s));

                const peerEvals = [
                    { name: cols[3].trim(), scores: [parseInt(cols[4]), parseInt(cols[5]), parseInt(cols[6]), parseInt(cols[7])] },
                    { name: cols[8].trim(), scores: [parseInt(cols[9]), parseInt(cols[10]), parseInt(cols[11]), parseInt(cols[12])] },
                    { name: cols[13].trim(), scores: [parseInt(cols[14]), parseInt(cols[15]), parseInt(cols[16]), parseInt(cols[17])] }
                ];

                rawEvals.push(...peerEvals);
            });

            rawEvals.forEach(eval => {
                if (studentData[eval.name] && eval.scores.every(s => !isNaN(s))) {
                    studentData[eval.name].peerScores.push(...eval.scores);
                    allPeerScores.push(...eval.scores);
                    eval.scores.forEach((s, i) => {
                        studentData[eval.name].peerScoresByCriteria[i].push(s);
                        allPeerScoresByCriteria[i].push(s);
                    });
                }
            });

            const studentAverages = [];
            const studentGaps = [];

            Object.values(studentData).forEach(s => {
                s.peerAvg = s.peerScores.length ? s.peerScores.reduce((a, b) => a + b, 0) / s.peerScores.length : 0;
                s.gap = s.selfAvg - s.peerAvg;

                studentAverages.push({
                    name: s.name,
                    peerAvg: s.peerAvg,
                    selfAvg: s.selfAvg
                });
                
                studentGaps.push({
                    name: s.name,
                    gap: s.gap
                });
            });

            studentAverages.sort((a, b) => a.name.localeCompare(b.name, 'ko'));
            studentGaps.sort((a, b) => b.gap - a.gap);

            const classPeerAvg = allPeerScores.length ? allPeerScores.reduce((a, b) => a + b, 0) / allPeerScores.length : 0;
            const classSelfAvg = allSelfScores.length ? allSelfScores.reduce((a, b) => a + b, 0) / allSelfScores.length : 0;

            const criteriaPeerAvg = allPeerScoresByCriteria.map(arr => arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : 0);
            const criteriaSelfAvg = allSelfScoresByCriteria.map(arr => arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : 0);

            const scoreDistribution = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
            allPeerScores.forEach(score => {
                if (score >= 1 && score <= 5) {
                    scoreDistribution[score]++;
                }
            });

            return {
                studentAverages,
                studentGaps,
                classAvgs: { peer: classPeerAvg, self: classSelfAvg },
                criteriaAvgs: { peer: criteriaPeerAvg, self: criteriaSelfAvg },
                scoreDistribution
            };
        }

        function renderDistributionChart(distData) {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['1점', '2점', '3점', '4점', '5점'],
                    datasets: [{
                        label: '동료 평가 점수 빈도',
                        data: Object.values(distData),
                        backgroundColor: [
                            palette.red,
                            palette.yellow,
                            palette.green,
                            palette.blue,
                            palette.darkBlue
                        ],
                        borderColor: 'rgba(255, 255, 255, 0.3)',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...mandatoryTooltipConfig,
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '횟수'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '점수'
                            }
                        }
                    },
                    plugins: {
                        ...mandatoryTooltipConfig.plugins,
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function renderComparisonChart(avgData) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: avgData.map(s => wrapLabels(s.name)),
                    datasets: [
                        {
                            label: '동료 평가 평균',
                            data: avgData.map(s => s.peerAvg),
                            backgroundColor: palette.red,
                            borderColor: palette.red,
                            borderWidth: 1
                        },
                        {
                            label: '자기 평가 평균',
                            data: avgData.map(s => s.selfAvg),
                            backgroundColor: palette.blue,
                            borderColor: palette.blue,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    ...mandatoryTooltipConfig,
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            title: {
                                display: true,
                                text: '평균 점수'
                            }
                        }
                    },
                    plugins: {
                        ...mandatoryTooltipConfig.plugins,
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }
        
        function renderGapChart(gapData) {
            const ctx = document.getElementById('gapChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: gapData.map(s => wrapLabels(s.name)),
                    datasets: [{
                        label: '점수 차이 (자기 - 동료)',
                        data: gapData.map(s => s.gap),
                        backgroundColor: gapData.map(s => s.gap >= 0 ? palette.green : palette.red),
                        borderColor: gapData.map(s => s.gap >= 0 ? palette.green : palette.red),
                        borderWidth: 1
                    }]
                },
                options: {
                    ...mandatoryTooltipConfig,
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: '점수 차이 (Gap)'
                            }
                        }
                    },
                    plugins: {
                        ...mandatoryTooltipConfig.plugins,
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function renderCriteriaChart(criteriaData) {
            const ctx = document.getElementById('criteriaChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: criteriaLabels,
                    datasets: [
                        {
                            label: '동료 평가 평균',
                            data: criteriaData.peer,
                            backgroundColor: 'rgba(255, 107, 107, 0.2)',
                            borderColor: palette.red,
                            pointBackgroundColor: palette.red,
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: palette.red
                        },
                        {
                            label: '자기 평가 평균',
                            data: criteriaData.self,
                            backgroundColor: 'rgba(17, 138, 178, 0.2)',
                            borderColor: palette.blue,
                            pointBackgroundColor: palette.blue,
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: palette.blue
                        }
                    ]
                },
                options: {
                    ...mandatoryTooltipConfig,
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5,
                            pointLabels: {
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    plugins: {
                        ...mandatoryTooltipConfig.plugins,
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        window.onload = function() {
            try {
                const data = parseData(csvData);

                document.getElementById('classPeerAvg').textContent = data.classAvgs.peer.toFixed(2);
                document.getElementById('classSelfAvg').textContent = data.classAvgs.self.toFixed(2);
                
                renderDistributionChart(data.scoreDistribution);
                renderComparisonChart(data.studentAverages);
                renderGapChart(data.studentGaps);
                renderCriteriaChart(data.criteriaAvgs);

            } catch (error) {
                console.error("데이터를 파싱하거나 차트를 그리는 중 오류 발생:", error);
                document.body.innerHTML = "<div class='text-center p-10 text-red-500'>데이터를 처리하는 중 오류가 발생했습니다.</div>";
            }
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ­ì–´ 3ë‹¨ì› í‰ê°€ ì¸í¬ê·¸ë˜í”½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F0F4F8;
            color: #073B4C;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .chart-container-large {
            position: relative;
            width: 100%;
            max-width: 1024px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 500px;
        }
         @media (min-width: 768px) {
            .chart-container-large {
                height: 500px;
            }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white shadow-md w-full sticky top-0 z-10">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-2xl md:text-3xl font-bold text-center text-[#073B4C]">êµ­ì–´ 3ë‹¨ì› í† ì˜ í™œë™: ë™ë£Œ í‰ê°€ ë° ìê¸° í‰ê°€ ì¸í¬ê·¸ë˜í”½</h1>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">

            <section class="md:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#118AB2] mb-3">ë“¤ì–´ê°€ë©°: ìš°ë¦¬ì˜ í† ì˜ íƒœë„ ë˜ëŒì•„ë³´ê¸°</h2>
                <p class="text-base md:text-lg leading-relaxed">
                    ì´ë²ˆ êµ­ì–´ 3ë‹¨ì› í† ì˜ í™œë™ì„ ë§ˆë¬´ë¦¬í•˜ë©°, ìš°ë¦¬ëŠ” ë™ë£Œ í‰ê°€ì™€ ìê¸° í‰ê°€ë¥¼ í†µí•´ ìì‹ ì˜ í† ì˜ íƒœë„ë¥¼ ë˜ëŒì•„ë³´ëŠ” ì‹œê°„ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤. ì´ ì¸í¬ê·¸ë˜í”½ì€ ìš°ë¦¬ê°€ ì„œë¡œë¥¼ ì–´ë–»ê²Œ í‰ê°€í–ˆëŠ”ì§€, ê·¸ë¦¬ê³  ìŠ¤ìŠ¤ë¡œë¥¼ ì–´ë–»ê²Œ ìƒê°í•˜ëŠ”ì§€ ë°ì´í„°ë¥¼ í†µí•´ ì‚´í´ë´…ë‹ˆë‹¤.
                </p>
            </section>

            <section class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#118AB2] mb-4">ì „ì²´ í‰ê·  ì ìˆ˜</h3>
                <p class="text-gray-700 mb-6">í•™ê¸‰ ì „ì²´ì˜ ë™ë£Œ í‰ê°€ í‰ê· ê³¼ ìê¸° í‰ê°€ í‰ê·  ì ìˆ˜ì…ë‹ˆë‹¤. 5ì  ë§Œì  ê¸°ì¤€ì…ë‹ˆë‹¤.</p>
                <div class="flex justify-around items-center text-center">
                    <div>
                        <span id="classPeerAvg" class="text-6xl font-bold text-[#FF6B6B]">0.0</span>
                        <p class="text-lg font-semibold text-gray-800 mt-2">ë™ë£Œ í‰ê°€ í‰ê· </p>
                    </div>
                    <div>
                        <span id="classSelfAvg" class="text-6xl font-bold text-[#118AB2]">0.0</span>
                        <p class="text-lg font-semibold text-gray-800 mt-2">ìê¸° í‰ê°€ í‰ê· </p>
                    </div>
                </div>
            </section>

            <section class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#118AB2] mb-4">ë™ë£Œ í‰ê°€ ì ìˆ˜ ë¶„í¬</h3>
                <p class="text-gray-700 mb-6">ì¹œêµ¬ë“¤ì´ ì„œë¡œì—ê²Œ ì¤€ ì ìˆ˜(1ì ~5ì )ê°€ ê°ê° ëª‡ ë²ˆ ë‚˜ì™”ëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                <div class="chart-container" style="height: 300px; max-height: 350px;">
                    <canvas id="distributionChart"></canvas>
                </div>
            </section>

            <section class="md:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#118AB2] mb-3">í•™ìƒë³„ ìƒì„¸ ë¹„êµ: ë™ë£Œ í‰ê°€ vs ìê¸° í‰ê°€</h2>
                <p class="text-base md:text-lg leading-relaxed mb-6">
                    ê° í•™ìƒì´ ë™ë£Œë“¤ì—ê²Œ ë°›ì€ í‰ê·  ì ìˆ˜(ë¹¨ê°„ìƒ‰)ì™€ ìŠ¤ìŠ¤ë¡œ í‰ê°€í•œ í‰ê·  ì ìˆ˜(íŒŒë€ìƒ‰)ë¥¼ ë‚˜ë€íˆ ë¹„êµí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê°œì¸ë³„ ì¸ì‹ ì°¨ì´ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <div class="chart-container-large">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </section>

            <section class="md:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#118AB2] mb-3">ì¸ì‹ ì°¨ì´ ë¶„ì„: 'ìê¸° í‰ê°€' - 'ë™ë£Œ í‰ê°€'</h2>
                <p class="text-base md:text-lg leading-relaxed mb-6">
                    ìì‹ ì˜ í‰ê°€(ìê¸° í‰ê°€)ì™€ íƒ€ì¸ì˜ í‰ê°€(ë™ë£Œ í‰ê°€) ì‚¬ì´ì˜ ì°¨ì´(Gap)ë¥¼ ì‹œê°í™”í–ˆìŠµë‹ˆë‹¤.
                    <span class="font-bold text-[#06D6A0]">ì–‘ìˆ˜(+) ê°’</span>ì€ ìì‹ ì„ ë™ë£Œë“¤ë³´ë‹¤ ë” ê¸ì •ì ìœ¼ë¡œ í‰ê°€í–ˆìŒì„, 
                    <span class="font-bold text-[#FF6B6B]">ìŒìˆ˜(-) ê°’</span>ì€ ìì‹ ì„ ë” ë‚®ê²Œ í‰ê°€í–ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
                </p>
                <div class="chart-container-large">
                    <canvas id="gapChart"></canvas>
                </div>
            </section>
            
            <section class="md:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#118AB2] mb-3">4ê°€ì§€ í‰ê°€ ê¸°ì¤€ë³„ ë¶„ì„</h2>
                <p class="text-base md:text-lg leading-relaxed mb-6">
                    ìš°ë¦¬ì˜ í† ì˜ íƒœë„ë¥¼ 4ê°€ì§€ ì„¸ë¶€ ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. í•™ê¸‰ ì „ì²´ê°€ ê° ê¸°ì¤€ì— ëŒ€í•´ ë™ë£Œ(ë¹¨ê°„ìƒ‰)ì™€ ìŠ¤ìŠ¤ë¡œ(íŒŒë€ìƒ‰)ë¥¼ ì–´ë–»ê²Œ í‰ê°€í–ˆëŠ”ì§€ ë¹„êµí•´ ë³´ì„¸ìš”.
                </p>
            </section>

            <section class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#118AB2] mb-4">ê¸°ì¤€ë³„ í‰ê·  ì ìˆ˜ (ë ˆì´ë” ì°¨íŠ¸)</h3>
                <p class="text-gray-700 mb-6">ì¤‘ì‹¬ì—ì„œ ë©€ì–´ì§ˆìˆ˜ë¡ í•´ë‹¹ ê¸°ì¤€ì˜ ì ìˆ˜ê°€ ë†’ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
                <div class="chart-container">
                    <canvas id="criteriaChart"></canvas>
                </div>
            </section>

            <section class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#118AB2] mb-4">ì£¼ìš” ë°œê²¬ì </h3>
                <ul class="space-y-4">
                    <li class="flex items-start">
                        <span class="text-2xl text-[#06D6A0] mr-3">âœ”</span>
                        <div>
                            <h4 class="font-bold text-lg text-gray-800">'ê²½ì²­í•˜ê¸°'ì™€ 'ì¡´ëŒ“ë§ ì‚¬ìš©'</h4>
                            <p class="text-gray-700">ë‘ í•­ëª© ëª¨ë‘ ë™ë£Œ í‰ê°€ì™€ ìê¸° í‰ê°€ì—ì„œ ë¹„êµì  ë†’ì€ ì ìˆ˜ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤. ìš°ë¦¬ê°€ ì„œë¡œì˜ ì˜ê²¬ì„ ì˜ ë“£ê³  ì¡´ì¤‘í•˜ë ¤ ë…¸ë ¥í–ˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="text-2xl text-[#FFD166] mr-3">ğŸ”</span>
                        <div>
                            <h4 class="font-bold text-lg text-gray-800">'ë¼ì–´ë“¤ì§€ ì•Šê¸°'</h4>
                            <p class="text-gray-700">ìê¸° í‰ê°€ëŠ” ë†’ì§€ë§Œ ë™ë£Œ í‰ê°€ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë‚®ê²Œ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤. 'ë‚˜ëŠ” ë¼ì–´ë“¤ì§€ ì•Šì•˜ë‹¤'ê³  ìƒê°í•˜ì§€ë§Œ, ì¹œêµ¬ë“¤ì€ ê°€ë” ëŒ€í™”ì— ë¼ì–´ë“ ë‹¤ê³  ëŠê¼ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="text-2xl text-[#FF6B6B] mr-3">â—</span>
                        <div>
                            <h4 class="font-bold text-lg text-gray-800">'ëª©ì†Œë¦¬ í¬ê¸°'</h4>
                            <p class="text-gray-700">ìê¸° í‰ê°€ ì ìˆ˜ì™€ ë™ë£Œ í‰ê°€ ì ìˆ˜ ê°„ì˜ ì°¨ì´ê°€ ê°€ì¥ í° í•­ëª© ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. 'ë‚˜ëŠ” ì˜ ë“¤ë¦¬ê²Œ ë§í–ˆë‹¤'ê³  ìƒê°í•˜ì§€ë§Œ, ë“£ëŠ” ì¹œêµ¬ë“¤ì—ê²ŒëŠ” ëª©ì†Œë¦¬ê°€ ì‘ê²Œ ë“¤ë ¸ì„ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    </li>
                </ul>
            </section>
        </div>
    </main>

    <footer class="text-center p-6 mt-8 text-gray-600 text-sm">
        <p>êµ­ì–´ 3ë‹¨ì› í† ì˜ í™œë™ í‰ê°€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ëœ ì¸í¬ê·¸ë˜í”½ì…ë‹ˆë‹¤.</p>
    </footer>

    <script>
        const csvData = `íƒ€ì„ìŠ¤íƒ¬í”„,ë²ˆí˜¸ëŠ”?,ì´ë¦„ì€?,ìš°ë¦¬ ëª¨ë‘ ì—ì„œ ê°™ì´ í† ì˜í•œ ì¹œêµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.,ìœ„ ì¹œêµ¬ê°€ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì´ ì˜ê²¬ì„ ë§í•˜ëŠ” ë„ì¤‘ì— ë¼ì–´ë“¤ì§€ ì•Šì•˜ë‚˜ìš”?,ìœ„ ì¹œêµ¬ê°€ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì´ ì˜ê²¬ì„ ì¡´ì¢…í•˜ë©° ë†’ì„ë§ì„ ì‚¬ìš©í•˜ì˜€ë‚˜ìš”?,ìœ„ ì¹œêµ¬ê°€ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì˜ ì˜ê²¬ì„ ê²½ì²­í•˜ì˜€ë‚˜ìš”?,ìœ„ ì¹œêµ¬ëŠ” ë“¤ì„ ìˆ˜ ìˆëŠ” ëª©ì†Œë¦¬ í¬ê¸°ë¡œ ë§í•˜ì˜€ë‚˜ìš”?,ìš°ë¦¬ ëª¨ë‘ ì—ì„œ ê°™ì´ í† ì˜í•œ ì¹œêµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.,ìœ„ ì¹œêµ¬ê°€ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì´ ì˜ê²¬ì„ ë§í•˜ëŠ” ë„ì¤‘ì— ë¼ì–´ë“¤ì§€ ì•Šì•˜ë‚˜ìš”?,ìœ„ ì¹œêµ¬ê°€ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì´ ì˜ê²¬ì„ ì¡´ì¢…í•˜ë©° ë†’ì„ë§ì„ ì‚¬ìš©í•˜ì˜€ë‚˜ìš”?,ìœ„ ì¹œêµ¬ê°€ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì˜ ì˜ê²¬ì„ ê²½ì²­í•˜ì˜€ë‚˜ìš”?,ìœ„ ì¹œêµ¬ëŠ” ë“¤ì„ ìˆ˜ ìˆëŠ” ëª©ì†Œë¦¬ í¬ê¸°ë¡œ ë§í•˜ì˜€ë‚˜ìš”?,ìš°ë¦¬ ëª¨ë‘ ì—ì„œ ê°™ì´ í† ì˜í•œ ì¹œêµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.,ìœ„ ì¹œêµ¬ê°€ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì´ ì˜ê²¬ì„ ë§í•˜ëŠ” ë„ì¤‘ì— ë¼ì–´ë“¤ì§€ ì•Šì•˜ë‚˜ìš”?,ìœ„ ì¹œêµ¬ê°€ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì´ ì˜ê²¬ì„ ì¡´ì¢…í•˜ë©° ë†’ì„ë§ì„ ì‚¬ìš©í•˜ì˜€ë‚˜ìš”?,ìœ„ ì¹œêµ¬ê°€ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì˜ ì˜ê²¬ì„ ê²½ì²­í•˜ì˜€ë‚˜ìš”?,ìœ„ ì¹œêµ¬ëŠ” ë“¤ì„ ìˆ˜ ìˆëŠ” ëª©ì†Œë¦¬ í¬ê¸°ë¡œ ë§í•˜ì˜€ë‚˜ìš”?,ë‚˜ëŠ” ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì´ ì˜ê²¬ì„ ë§í•˜ëŠ” ë„ì¤‘ì— ë¼ì–´ë“¤ì§€ ì•Šì•˜ë‚˜ìš”?,ë‚˜ëŠ” ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì´ ì˜ê²¬ì„ ì¡´ì¢…í•˜ë©° ë†’ì„ë§ì„ ì‚¬ìš©í•˜ì˜€ë‚˜ìš”?,ë‚˜ëŠ” ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì˜ ì˜ê²¬ì„ ê²½ì²­í•˜ì˜€ë‚˜ìš”?,ë‚˜ëŠ” ë“¤ì„ ìˆ˜ ìˆëŠ” ëª©ì†Œë¦¬ í¬ê¸°ë¡œ ë§í•˜ì˜€ë‚˜ìš”?
2025. 10. 27 ì˜¤ì „ 9:57:07,2ë²ˆ,ê¹€ì†Œìœ¤,ê¹€í•˜ì˜,5,4,5,5,ì´ì§€í™˜,5,3,4,5,ìµœìˆ˜ì•„,5,4,5,5,5,4,5,4
2025. 10. 27 ì˜¤ì „ 9:57:23,17ë²ˆ,ìµœìˆ˜ì•„,ê¹€í•˜ì˜,5,4,4,5,ê¹€ì†Œìœ¤,5,4,5,3,ì´ì§€í™˜,5,5,4,5,5,4,4,4
2025. 10. 27 ì˜¤ì „ 9:57:33,11ë²ˆ,ì´ì˜¨ìœ ,ì†¡ì„œìœ ,5,5,5,4,ê¹€í•´ì†”,4,1,4,5,ì§€ë¯¼ì¬,5,1,5,4,5,1,5,3
2025. 10. 27 ì˜¤ì „ 9:57:37,4ë²ˆ,ê¹€í•˜ì˜,ê¹€ì†Œìœ¤,5,5,5,3,ì´ì§€í™˜,4,3,5,5,ìµœìˆ˜ì•„,4,4,3,1,5,4,5,5
2025. 10. 27 ì˜¤ì „ 9:57:39,5ë²ˆ,ê¹€í•´ì†”,ì†¡ì„œìœ ,5,5,5,5,ì´ì˜¨ìœ ,5,4,5,2,ì§€ë¯¼ì¬,5,4,5,5,5,4,5,5
2025. 10. 27 ì˜¤ì „ 9:57:47,16ë²ˆ,ì§€ë¯¼ì¬,ê¹€í•´ì†”,5,1,4,4,ì†¡ì„œìœ ,3,5,5,5,ì´ì˜¨ìœ ,4,4,4,1,4,3,5,4
2025. 10. 27 ì˜¤ì „ 9:57:56,12ë²ˆ,ì´ì˜ì •,í•œëŒ€ì—°,3,1,1,3,ê¹€ì‚¬ë‘,5,3,3,3,í•œì§€ì™„,2,1,1,3,3,4,5,3
2025. 10. 27 ì˜¤ì „ 9:57:59,8ë²ˆ,ì†¡ì„œìœ ,ì´ì˜¨ìœ ,5,4,5,3,ê¹€í•´ì†”,5,4,5,5,ì§€ë¯¼ì¬,5,4,5,5,5,5,5,4
2025. 10. 27 ì˜¤ì „ 9:57:59,10ë²ˆ,ì›ì§€í˜„,ì¡°ì—°ìš°,4,5,5,5,ìµœìœ í˜„,4,3,4,3,ìµœì‹œì›,4,4,5,4,4,5,5,4
2025. 10. 27 ì˜¤ì „ 9:58:15,19ë²ˆ,ìµœìœ í˜„,ìµœì‹œì›,2,2,2,5,ì¡°ì—°ìš°,4,5,3,4,ì›ì§€í˜„,3,3,4,2,4,5,5,5
2025. 10. 27 ì˜¤ì „ 9:58:22,1ë²ˆ,ê¹€ì‚¬ë‘,ì´ì˜ì •,5,5,4,5,í•œëŒ€ì—°,4,3,2,3,í•œì§€ì™„,4,3,3,4,5,4,5,4
2025. 10. 27 ì˜¤ì „ 9:58:34,20ë²ˆ,í•œëŒ€ì—°,í•œì§€ì™„,3,3,5,5,í•œì§€ì™„,2,3,5,5,í•œì§€ì™„,2,3,5,5,2,1,5,3
2025. 10. 27 ì˜¤ì „ 9:58:45,21ë²ˆ,í•œì§€ì™„,ê¹€ì‚¬ë‘,3,2,4,2,ì´ì˜ì •,3,2,3,3,í•œëŒ€ì—°,2,2,2,1,3,3,2,3
2025. 10. 27 ì˜¤ì „ 9:59:25,18ë²ˆ,ìµœì‹œì›,ìµœìœ í˜„,1,2,1,4,ì¡°ì—°ìš°,4,4,5,4,ì›ì§€í˜„,5,2,2,2,3,2,2,4
2025. 10. 27 ì˜¤ì „ 9:59:33,13ë²ˆ,ì´ì§€í™˜,ê¹€í•˜ì˜,4,3,4,3,ê¹€ì†Œìœ¤,4,3,4,3,ìµœìˆ˜ì•„,4,4,4,4,5,5,3,5
2025. 10. 27 ì˜¤ì „ 9:59:50,14ë²ˆ,ì¡°ì—°ìš°,ìµœìœ í˜„,1,1,1,2,ìµœì‹œì›,2,1,1,1,ì›ì§€í˜„,4,2,3,2,4,4,5,4`;

        const palette = {
            red: '#FF6B6B',
            yellow: '#FFD166',
            green: '#06D6A0',
            blue: '#118AB2',
            darkBlue: '#073B4C',
            background: '#F0F4F8'
        };

        const criteriaLabels = ["ë¼ì–´ë“¤ì§€ ì•Šê¸°", "ì¡´ëŒ“ë§ ì‚¬ìš©", "ê²½ì²­í•˜ê¸°", "ëª©ì†Œë¦¬ í¬ê¸°"];

        const mandatoryTooltipConfig = {
            plugins: {
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) {
                                return label.join(' ');
                            } else {
                                return label;
                            }
                        }
                    }
                }
            }
        };

        function wrapLabels(label) {
            if (typeof label === 'string' && label.length > 16) {
                const words = label.split(' ');
                const lines = [];
                let currentLine = '';
                words.forEach(word => {
                    if ((currentLine + word).length > 16 && currentLine.length > 0) {
                        lines.push(currentLine.trim());
                        currentLine = word + ' ';
                    } else {
                        currentLine += word + ' ';
                    }
                });
                lines.push(currentLine.trim());
                return lines;
            }
            return label;
        }

        function parseData(csvString) {
            const lines = csvString.trim().split('\n');
            const header = lines.shift();
            
            const studentData = {};
            const allPeerScores = [];
            const allSelfScores = [];
            const allPeerScoresByCriteria = [[], [], [], []];
            const allSelfScoresByCriteria = [[], [], [], []];

            const rawEvals = [];

            lines.forEach(line => {
                const cols = line.split(',');
                const name = cols[2].trim();
                
                if (!name) return;

                const selfScores = [
                    parseInt(cols[18]), 
                    parseInt(cols[19]), 
                    parseInt(cols[20]), 
                    parseInt(cols[21])
                ].filter(s => !isNaN(s));

                studentData[name] = {
                    name: name,
                    selfScores: selfScores,
                    selfAvg: selfScores.length ? selfScores.reduce((a, b) => a + b, 0) / selfScores.length : 0,
                    peerScores: [],
                    peerScoresByCriteria: [[], [], [], []]
                };

                allSelfScores.push(...selfScores);
                selfScores.forEach((s, i) => allSelfScoresByCriteria[i].push(s));

                const peerEvals = [
                    { name: cols[3].trim(), scores: [parseInt(cols[4]), parseInt(cols[5]), parseInt(cols[6]), parseInt(cols[7])] },
                    { name: cols[8].trim(), scores: [parseInt(cols[9]), parseInt(cols[10]), parseInt(cols[11]), parseInt(cols[12])] },
                    { name: cols[13].trim(), scores: [parseInt(cols[14]), parseInt(cols[15]), parseInt(cols[16]), parseInt(cols[17])] }
                ];

                rawEvals.push(...peerEvals);
            });

            rawEvals.forEach(eval => {
                if (studentData[eval.name] && eval.scores.every(s => !isNaN(s))) {
                    studentData[eval.name].peerScores.push(...eval.scores);
                    allPeerScores.push(...eval.scores);
                    eval.scores.forEach((s, i) => {
                        studentData[eval.name].peerScoresByCriteria[i].push(s);
                        allPeerScoresByCriteria[i].push(s);
                    });
                }
            });

            const studentAverages = [];
            const studentGaps = [];

            Object.values(studentData).forEach(s => {
                s.peerAvg = s.peerScores.length ? s.peerScores.reduce((a, b) => a + b, 0) / s.peerScores.length : 0;
                s.gap = s.selfAvg - s.peerAvg;

                studentAverages.push({
                    name: s.name,
                    peerAvg: s.peerAvg,
                    selfAvg: s.selfAvg
                });
                
                studentGaps.push({
                    name: s.name,
                    gap: s.gap
                });
            });

            studentAverages.sort((a, b) => a.name.localeCompare(b.name, 'ko'));
            studentGaps.sort((a, b) => b.gap - a.gap);

            const classPeerAvg = allPeerScores.length ? allPeerScores.reduce((a, b) => a + b, 0) / allPeerScores.length : 0;
            const classSelfAvg = allSelfScores.length ? allSelfScores.reduce((a, b) => a + b, 0) / allSelfScores.length : 0;

            const criteriaPeerAvg = allPeerScoresByCriteria.map(arr => arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : 0);
            const criteriaSelfAvg = allSelfScoresByCriteria.map(arr => arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : 0);

            const scoreDistribution = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
            allPeerScores.forEach(score => {
                if (score >= 1 && score <= 5) {
                    scoreDistribution[score]++;
                }
            });

            return {
                studentAverages,
                studentGaps,
                classAvgs: { peer: classPeerAvg, self: classSelfAvg },
                criteriaAvgs: { peer: criteriaPeerAvg, self: criteriaSelfAvg },
                scoreDistribution
            };
        }

        function renderDistributionChart(distData) {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['1ì ', '2ì ', '3ì ', '4ì ', '5ì '],
                    datasets: [{
                        label: 'ë™ë£Œ í‰ê°€ ì ìˆ˜ ë¹ˆë„',
                        data: Object.values(distData),
                        backgroundColor: [
                            palette.red,
                            palette.yellow,
                            palette.green,
                            palette.blue,
                            palette.darkBlue
                        ],
                        borderColor: 'rgba(255, 255, 255, 0.3)',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...mandatoryTooltipConfig,
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'íšŸìˆ˜'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'ì ìˆ˜'
                            }
                        }
                    },
                    plugins: {
                        ...mandatoryTooltipConfig.plugins,
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function renderComparisonChart(avgData) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: avgData.map(s => wrapLabels(s.name)),
                    datasets: [
                        {
                            label: 'ë™ë£Œ í‰ê°€ í‰ê· ',
                            data: avgData.map(s => s.peerAvg),
                            backgroundColor: palette.red,
                            borderColor: palette.red,
                            borderWidth: 1
                        },
                        {
                            label: 'ìê¸° í‰ê°€ í‰ê· ',
                            data: avgData.map(s => s.selfAvg),
                            backgroundColor: palette.blue,
                            borderColor: palette.blue,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    ...mandatoryTooltipConfig,
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            title: {
                                display: true,
                                text: 'í‰ê·  ì ìˆ˜'
                            }
                        }
                    },
                    plugins: {
                        ...mandatoryTooltipConfig.plugins,
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }
        
        function renderGapChart(gapData) {
            const ctx = document.getElementById('gapChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: gapData.map(s => wrapLabels(s.name)),
                    datasets: [{
                        label: 'ì ìˆ˜ ì°¨ì´ (ìê¸° - ë™ë£Œ)',
                        data: gapData.map(s => s.gap),
                        backgroundColor: gapData.map(s => s.gap >= 0 ? palette.green : palette.red),
                        borderColor: gapData.map(s => s.gap >= 0 ? palette.green : palette.red),
                        borderWidth: 1
                    }]
                },
                options: {
                    ...mandatoryTooltipConfig,
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'ì ìˆ˜ ì°¨ì´ (Gap)'
                            }
                        }
                    },
                    plugins: {
                        ...mandatoryTooltipConfig.plugins,
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function renderCriteriaChart(criteriaData) {
            const ctx = document.getElementById('criteriaChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: criteriaLabels,
                    datasets: [
                        {
                            label: 'ë™ë£Œ í‰ê°€ í‰ê· ',
                            data: criteriaData.peer,
                            backgroundColor: 'rgba(255, 107, 107, 0.2)',
                            borderColor: palette.red,
                            pointBackgroundColor: palette.red,
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: palette.red
                        },
                        {
                            label: 'ìê¸° í‰ê°€ í‰ê· ',
                            data: criteriaData.self,
                            backgroundColor: 'rgba(17, 138, 178, 0.2)',
                            borderColor: palette.blue,
                            pointBackgroundColor: palette.blue,
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: palette.blue
                        }
                    ]
                },
                options: {
                    ...mandatoryTooltipConfig,
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5,
                            pointLabels: {
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    plugins: {
                        ...mandatoryTooltipConfig.plugins,
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        window.onload = function() {
            try {
                const data = parseData(csvData);

                document.getElementById('classPeerAvg').textContent = data.classAvgs.peer.toFixed(2);
                document.getElementById('classSelfAvg').textContent = data.classAvgs.self.toFixed(2);
                
                renderDistributionChart(data.scoreDistribution);
                renderComparisonChart(data.studentAverages);
                renderGapChart(data.studentGaps);
                renderCriteriaChart(data.criteriaAvgs);

            } catch (error) {
                console.error("ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ê±°ë‚˜ ì°¨íŠ¸ë¥¼ ê·¸ë¦¬ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                document.body.innerHTML = "<div class='text-center p-10 text-red-500'>ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>";
            }
        };
    </script>
</body>
</html>
